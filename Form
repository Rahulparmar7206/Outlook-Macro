Private Sub UserForm_Initialize()
    ' Set Desktop path as default
    txtPath.Text = CreateObject("WScript.Shell").SpecialFolders("Desktop")
    txtFolderName.Text = ""
    txtFolderName.SetFocus
End Sub

Private Sub btnBrowse_Click()
    Dim objExcel As Object
    Dim objDialog As Object
    Dim strPath As String
    
    On Error Resume Next
    
    ' Create Excel Application for FileDialog
    Set objExcel = CreateObject("Excel.Application")
    objExcel.Visible = False
    
    ' Use FileDialog with msoFileDialogFolderPicker
    Set objDialog = objExcel.FileDialog(4)
    
    With objDialog
        .Title = "Select folder to save attachments"
        .AllowMultiSelect = False
        .ButtonName = "Select"
        .InitialFileName = txtPath.Text & "\"
        
        If .Show = -1 Then
            strPath = .SelectedItems(1)
            txtPath.Text = strPath
        End If
    End With
    
    ' Clean up
    objExcel.Quit
    Set objDialog = Nothing
    Set objExcel = Nothing
    
    On Error GoTo 0
End Sub

Private Sub btnOK_Click()
    ' Validate path
    If txtPath.Text = "" Then
        MsgBox "Please enter or select a save location.", vbExclamation
        Exit Sub
    End If
    
    ' Validate folder name
    If txtFolderName.Text = "" Then
        MsgBox "Please enter a folder name.", vbExclamation
        Exit Sub
    End If
    
    ' Check if path exists
    Dim FSO As Object
    Set FSO = CreateObject("Scripting.FileSystemObject")
    
    If Not FSO.FolderExists(txtPath.Text) Then
        MsgBox "The specified path does not exist. Please enter a valid path or click Browse.", vbExclamation
        Set FSO = Nothing
        Exit Sub
    End If
    
    Set FSO = Nothing
    
    ' Hide form and proceed
    Me.Hide
End Sub

Private Sub btnCancel_Click()
    ' Clear values and close
    txtPath.Text = ""
    txtFolderName.Text = ""
    Me.Hide
End Sub
